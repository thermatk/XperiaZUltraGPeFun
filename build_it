### select toolchain
## GCC 4.4.3
##CUR_TC=/home/doomlord/android/system/prebuilt/linux-x86/toolchain/arm-eabi-4.4.3/bin/
## GCC 4.6 Linaro
CUR_TC=/home/thermatk/toolchain-4.6/bin/
## GCC 4.7 Linaro
##CUR_TC=/home/doomlord/android-toolchain-eabi-linaro-4.7-2013.01/bin/

### compile kernel
ARCH=arm CROSS_COMPILE=${CUR_TC}arm-eabi- make -j8
#ARCH=arm CROSS_COMPILE=~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi- make -j8

echo "checking for compiled kernel..."
if [ -f arch/arm/boot/zImage ]
then

echo "generating device tree..."
./dtbTool -o ../final_files/dt.img -s 2048 -p ./scripts/dtc/ ./arch/arm/boot/

### copy zImage
cp arch/arm/boot/zImage ../final_files/.
cp arch/arm/mach-msm/dma_test.ko ../final_files/.
cp crypto/ansi_cprng.ko ../final_files/.
cp drivers/gud/mcdrvmodule.ko ../final_files/.
cp drivers/gud/mckernelapi.ko ../final_files/.
cp drivers/media/radio/radio-iris-transport.ko ../final_files/.
cp drivers/misc/eeprom/eeprom_93cx6.ko ../final_files/.
cp drivers/misc/tspp.ko ../final_files/.
cp drivers/scsi/scsi_wait_scan.ko ../final_files/.
cp drivers/char/adsprpc.ko ../final_files/.
cp arch/arm/mach-msm/qdsp6v2/adsp-loader.ko ../final_files/.
cp net/wireless/cfg80211.ko ../final_files/.
cp ./drivers/coresight/coresight-event.ko ../final_files/.
cp ./arch/arm/mach-msm/reset_modem.ko ../final_files/.
cp ./drivers/spi/spidev.ko ../final_files/.
cp ./drivers/net/ethernet/micrel/ks8851.ko ../final_files/.
cp ./drivers/crypto/msm/qcrypto.ko ../final_files/.
cp ./drivers/mmc/card/mmc_test.ko ../final_files/.
cp ./block/test-iosched.ko ../final_files/.
cp ./arch/arm/mach-msm/qdsp6v2/adsp-loader.ko ../final_files/.
cp ./drivers/gud/mcdrvmodule.ko ../final_files/.
cp ./arch/arm/mach-msm/msm-buspm-dev.ko ../final_files/.
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/adsprpc.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/adsp-loader.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/cfg80211.ko 
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/coresight-event.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/reset_modem.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/spidev.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/ks8851.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/qcrypto.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/mmc_test.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/test-iosched.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/adsp-loader.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/mcdrvmodule.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/msm-buspm-dev.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/dma_test.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/ansi_cprng.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/mcdrvmodule.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/mckernelapi.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/radio-iris-transport.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/eeprom_93cx6.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/tspp.ko
~/arm-linux-androideabi-4.7/bin/arm-linux-androideabi-strip --strip-unneeded ../final_files/scsi_wait_scan.ko
echo "DONE"

fi
